var currScript,currVersion=15,isOnline=!1,popupInstance=null,jQEngager,peer_avatar,peer_name,comm_controller,roomId,iframeId,openTab=!1;if(currScript=document.currentScript||function(){var a=document.getElementById('newdev-embed-script');return a}(),null==currScript||currScript==void 0){var scripts=document.getElementsByTagName('script'),index=scripts.length-1;currScript=scripts[index]}var lsRepUrl=currScript.getAttribute('data-source_path'),initVideoNewDev=function(){var b=currScript.getAttribute('data-button-css')?currScript.getAttribute('data-button-css'):'button.css',c=currScript.getAttribute('data-message')?currScript.getAttribute('data-message'):'Start Video Chat';if(peer_avatar=currScript.getAttribute('data-avatar')?currScript.getAttribute('data-avatar'):'',peer_name=currScript.getAttribute('data-names')?currScript.getAttribute('data-names'):'',roomId=currScript.getAttribute('data-room_id')?currScript.getAttribute('data-room_id'):'',iframeId=currScript.getAttribute('data-iframe_id')?currScript.getAttribute('data-iframe_id'):'',openTab=!!currScript.getAttribute('data-intab')&&currScript.getAttribute('data-intab'),roomId){var f=new Date,g=f.getTime();f.setTime(g+3600000),document.cookie='visitorId='+roomId+';expires='+f.toGMTString()+';path=/'}var i=function(){if(popupInstance&&!popupInstance.closed)popupInstance.focus();else{var p=350,q=445,r=screen.width/2-p/2,s=screen.height/2-q/2,t={};peer_avatar&&(t.avatar=peer_avatar),peer_name&&(t.names=peer_name),lsRepUrl&&(t.lsRepUrl=lsRepUrl);var u=window.btoa(JSON.stringify(t));if(openTab)var v='';else v='width='+p+', height='+q+', left='+r+', top='+s+', location=no, menubar=no, resizable=yes, scrollbars=no, status=no, titlebar=no, toolbar = no';var w=lsRepUrl+'pages/room.html?room='+comm_controller.getVisitorId()+'&p='+u;if(iframeId)jQEngager('#'+iframeId).attr('src',w);else{popupInstance=window.open('','popup_instance',v);try{'about:blank'===popupInstance.location.href&&(console.log(w),popupInstance.location.href=w)}catch(y){}popupInstance.focus()}window.addEventListener?window.addEventListener('message',j,!1):window.attachEvent('onmessage',j)}},j=function(p){p.data&&'popupClosed'===p.data.type&&comm_controller.popupClosed(comm_controller.getVisitorId())},l=function(){loadScript(lsRepUrl+'js/bundle.js',m)},m=function(){comm_controller=new comController,comm_controller.init();var p=jQEngager('<link>',{rel:'stylesheet',type:'text/css',href:lsRepUrl+'css/'+b+'?v='+currVersion});p.appendTo('head'),$container=jQEngager('#nd-widget-container'),o($container)},n=function(){var p='#widget_but_span';isOnline?jQEngager(p).attr('class','online-bnt'):jQEngager(p).attr('class','offline-bnt')};jQEngager(document).on('AdminPopupOnline',function(){isOnline=!0});var o=function(p){jQEngager.get(lsRepUrl+'pages/button.html',function(q){p.append(q),console.log('loadButton'),jQEngager(document).on('PushConnected',function(){n()}),jQEngager(document).on('PresenceUpdate',function(r){r.stopPropagation()}),jQEngager(document).on('CallEnded',function(){}),jQEngager(document).on('AdminOnline',function(){isOnline=!0,n()}),jQEngager(document).on('AdminPopupOnline',function(){isOnline=!0,n()}),jQEngager(document).on('AdminOffline',function(){isOnline=!1,n()}),jQEngager(p).on('ChatEnded',function(){}),jQEngager('#newdev_widget_msg').html(c),jQEngager('#widget-but').on('click',function(){isOnline&&i()})})};(function(){jQEngager.ajax({url:lsRepUrl+'config/config.ini?v='+currVersion,type:'GET',dataType:'json',beforeSend:function(p){p&&p.overrideMimeType&&p.overrideMimeType('application/j-son;charset=UTF-8')},success:function(p){svConfigs=p,l()}})})()};function loadScript(a,b){var c=document.createElement('script');c.type='text/javascript',c.readyState?c.onreadystatechange=function(){('loaded'==c.readyState||'complete'==c.readyState)&&(c.onreadystatechange=null,b&&b())}:c.onload=function(){b&&b()},c.src=a+'?v='+currVersion,document.getElementsByTagName('head')[0].appendChild(c)}var ms=Date.now();'undefined'==typeof jQuery||11>parseInt(jQuery.fn.jquery.split('.')[1])?loadScript('https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js',function(){jQEngager=jQuery.noConflict(!0),jQEngager.get(lsRepUrl+'pages/version.txt?v='+ms,function(a){currVersion=a,jQEngager(document).ready(new initVideoNewDev)})}):(jQEngager=jQuery,jQEngager.get(lsRepUrl+'pages/version.txt?v='+ms,function(a){currVersion=a,jQEngager(document).ready(new initVideoNewDev)}));