function RecordRTC(e,t){function a(a){return(!a||(t=new RecordRTCConfiguration(e,a)),t.disableLogs||console.log("started recording "+t.type+" stream."),g)?(g.clearRecordedData(),g.record(),u("recording"),m.recordingDuration&&c(),m):(i(function(){m.recordingDuration&&c()}),m)}function i(a){a&&(t.initCallback=function(){a(),a=t.initCallback=null});var i=new GetRecorderType(e,t);g=new i(e,t),g.record(),u("recording"),t.disableLogs||console.log("Initialized recorderType:",g.constructor.name,"for output-type:",t.type)}function o(e){function a(a){if(!g)return void("function"==typeof e.call?e.call(m,""):e(""));Object.keys(g).forEach(function(e){"function"==typeof g[e]||(m[e]=g[e])});var i=g.blob;if(!i)if(a)g.blob=i=a;else throw"Recording failed.";if(i&&!t.disableLogs&&console.log(i.type,"->",bytesToSize(i.size)),e){var o;try{o=URL.createObjectURL(i)}catch(t){}"function"==typeof e.call?e.call(m,o):e(o)}t.autoWriteToDisk&&s(function(e){var a={};a[t.type+"Blob"]=e,DiskStorage.Store(a)})}return e=e||function(){},g?"paused"===m.state?(m.resumeRecording(),void setTimeout(function(){o(e)},1)):void("recording"!==m.state&&!t.disableLogs&&console.warn("Recording state should be: \"recording\", however current state is: ",m.state),!t.disableLogs&&console.log("Stopped recording "+t.type+" stream."),"gif"===t.type?(g.stop(),a()):g.stop(a),u("stopped")):void l()}function r(){return g?"recording"===m.state?void(u("paused"),g.pause(),!t.disableLogs&&console.log("Paused recording.")):void(t.disableLogs||console.warn("Unable to pause the recording. Recording state: ",m.state)):void l()}function d(){return g?"paused"===m.state?void(u("recording"),g.resume(),!t.disableLogs&&console.log("Resumed recording.")):void(t.disableLogs||console.warn("Unable to resume the recording. Recording state: ",m.state)):void l()}function n(e){postMessage(new FileReaderSync().readAsDataURL(e))}function s(e,a){function i(e){try{var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),a=new Worker(t);return URL.revokeObjectURL(t),a}catch(t){}}if(!e)throw"Pass a callback function over getDataURL.";var o=a?a.blob:(g||{}).blob;if(!o)return t.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){s(e,a)},1e3);if("undefined"!=typeof Worker&&!navigator.mozGetUserMedia){var r=i(n);r.onmessage=function(t){e(t.data)},r.postMessage(o)}else{var d=new FileReader;d.readAsDataURL(o),d.onload=function(t){e(t.target.result)}}}function c(e){return e=e||0,"paused"===m.state?void setTimeout(function(){c(e)},1e3):"stopped"===m.state?void 0:e>=m.recordingDuration?void o(m.onRecordingStopped):void(e+=1e3,setTimeout(function(){c(e)},1e3))}function u(e){m&&(m.state=e,"function"==typeof m.onStateChanged.call?m.onStateChanged.call(m,e):m.onStateChanged(e))}function l(){!0===t.disableLogs||console.warn(p)}if(!e)throw"First parameter is required.";t=t||{type:"video"},t=new RecordRTCConfiguration(e,t);var g,m=this,p="It seems that recorder is destroyed or \"startRecording\" is not invoked for "+t.type+" recorder.",f={startRecording:a,stopRecording:o,pauseRecording:r,resumeRecording:d,initRecorder:i,setRecordingDuration:function(e,t){if("undefined"==typeof e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return m.recordingDuration=e,m.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){m.onRecordingStopped=e}}},clearRecordedData:function(){return g?void(g.clearRecordedData(),!t.disableLogs&&console.log("Cleared old recorded data.")):void l()},getBlob:function(){return g?g.blob:void l()},getDataURL:s,toURL:function(){return g?URL.createObjectURL(g.blob):void l()},getInternalRecorder:function(){return g},save:function(e){return g?void invokeSaveAsDialog(g.blob,e):void l()},getFromDisk:function(e){return g?void RecordRTC.getFromDisk(t.type,e):void l()},setAdvertisementArray:function(e){t.advertisement=[];for(var a=e.length,o=0;o<a;o++)t.advertisement.push({duration:o,image:e[o]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){g&&"function"==typeof g.clearRecordedData&&g.clearRecordedData(),g=null,u("inactive"),m.blob=null},onStateChanged:function(e){t.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return m.state},destroy:function(){var e=t.disableLogs;t={disableLogs:!0},m.reset(),u("destroyed"),f=m=null,Storage.AudioContextConstructor&&(Storage.AudioContextConstructor.close(),Storage.AudioContextConstructor=null),t.disableLogs=e,t.disableLogs||console.warn("RecordRTC is destroyed.")},version:"5.5.4"};if(!this)return m=f,f;for(var h in f)this[h]=f[h];return m=this,f}RecordRTC.version="5.5.4","undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),RecordRTC.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),DiskStorage.Fetch(function(a,i){"all"!==e&&i===e+"Blob"&&t&&t(a),"all"===e&&t&&t(a,i.replace("Blob",""))})},RecordRTC.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),e=e||{},e.audio&&e.video&&e.gif?e.audio.getDataURL(function(t){e.video.getDataURL(function(a){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:a,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){DiskStorage.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){DiskStorage.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){DiskStorage.Store({gifBlob:e})})};function RecordRTCConfiguration(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":!!t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===WhammyRecorder||t.recorderType===CanvasRecorder||"undefined"!=typeof WebAssemblyRecorder&&t.recorderType===WebAssemblyRecorder?t.type="video":t.recorderType===GifRecorder?t.type="gif":t.recorderType===StereoAudioRecorder?t.type="audio":t.recorderType===MediaStreamRecorder&&(getTracks(e,"audio").length&&getTracks(e,"video").length?t.type="video":!getTracks(e,"audio").length&&getTracks(e,"video").length?t.type="video":getTracks(e,"audio").length&&!getTracks(e,"video").length&&(t.type="audio"))),"undefined"!=typeof MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(!t.mimeType&&(t.mimeType="video/webm"),!t.type&&(t.type=t.mimeType.split("/")[0]),!t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),!t.type&&(t.type="audio")),t}function GetRecorderType(e,t){var a;return(isChrome||isEdge||isOpera)&&(a=StereoAudioRecorder),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(a=MediaStreamRecorder),"video"===t.type&&(isChrome||isOpera)&&(a=WhammyRecorder,"undefined"!=typeof WebAssemblyRecorder&&"undefined"!=typeof ReadableStream&&(a=WebAssemblyRecorder)),"gif"===t.type&&(a=GifRecorder),"canvas"===t.type&&(a=CanvasRecorder),isMediaRecorderCompatible()&&a!==CanvasRecorder&&a!==GifRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(getTracks(e,"video").length||getTracks(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(a=MediaStreamRecorder):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(a=MediaStreamRecorder)),e instanceof Array&&e.length&&(a=MultiStreamRecorder),t.recorderType&&(a=t.recorderType),t.disableLogs||!a||!a.name||console.log("Using recorderType:",a.name||a.constructor.name),!a&&isSafari&&(a=MediaStreamRecorder),a}function MRecordRTC(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t,a=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof a.audio&&isMediaRecorderCompatible()&&!getTracks(e,"audio").length&&(a.audio=!1),"function"!=typeof a.video&&isMediaRecorderCompatible()&&!getTracks(e,"video").length&&(a.video=!1),"function"!=typeof a.gif&&isMediaRecorderCompatible()&&!getTracks(e,"video").length&&(a.gif=!1),!a.audio&&!a.video&&!a.gif)throw"MediaStream must have either audio or video tracks.";if(!a.audio||(t=null,"function"==typeof a.audio&&(t=a.audio),this.audioRecorder=new RecordRTC(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:i.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),!a.video&&this.audioRecorder.startRecording()),!!a.video){t=null,"function"==typeof a.video&&(t=a.video);var o=e;if(isMediaRecorderCompatible()&&!!a.audio&&"function"==typeof a.audio){var r=getTracks(e,"video")[0];isFirefox?(o=new MediaStream,o.addTrack(r),t&&t===WhammyRecorder&&(t=MediaStreamRecorder)):(o=new MediaStream,o.addTrack(r))}this.videoRecorder=new RecordRTC(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:i.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),a.audio||this.videoRecorder.startRecording()}if(!!a.audio&&!!a.video){var d=this,n=!0===isMediaRecorderCompatible();a.audio instanceof StereoAudioRecorder&&!!a.video?n=!1:!0!==a.audio&&!0!==a.video&&a.audio!==a.video&&(n=!1),!0===n?(d.audioRecorder=null,d.videoRecorder.startRecording()):d.videoRecorder.initRecorder(function(){d.audioRecorder.initRecorder(function(){d.videoRecorder.startRecording(),d.audioRecorder.startRecording()})})}!a.gif||(t=null,"function"==typeof a.gif&&(t=a.gif),this.gifRecorder=new RecordRTC(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var i=a(function(e){postMessage(new FileReaderSync().readAsDataURL(e))});i.onmessage=function(e){t(e.data)},i.postMessage(e)}else{var o=new FileReader;o.readAsDataURL(e),o.onload=function(e){t(e.target.result)}}}function a(e){var t,a=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),i=new Worker(a);if("undefined"!=typeof URL)t=URL;else if("undefined"!=typeof webkitURL)t=webkitURL;else throw"Neither URL nor webkitURL detected.";return t.revokeObjectURL(a),i}this.getBlob(function(a){a.audio&&a.video?t(a.audio,function(i){t(a.video,function(t){e({audio:i,video:t})})}):a.audio?t(a.audio,function(t){e({audio:t})}):a.video&&t(a.video,function(t){e({video:t})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},!!e.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),!!e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),!!e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,"undefined"!=typeof RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},!global.console&&(global.console={}),("undefined"==typeof global.console.log||"undefined"==typeof global.console.error)&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})("undefined"==typeof global?null:global);var requestAnimationFrame=window.requestAnimationFrame;if("undefined"==typeof requestAnimationFrame)if("undefined"!=typeof webkitRequestAnimationFrame)requestAnimationFrame=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)requestAnimationFrame=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)requestAnimationFrame=msRequestAnimationFrame;else if("undefined"==typeof requestAnimationFrame){var lastTime=0;requestAnimationFrame=function(e){var t=new Date().getTime(),a=Math.max(0,16-(t-lastTime)),i=setTimeout(function(){e(t+a)},a);return lastTime=t+a,i}}var cancelAnimationFrame=window.cancelAnimationFrame;"undefined"==typeof cancelAnimationFrame&&("undefined"==typeof webkitCancelAnimationFrame?"undefined"==typeof mozCancelAnimationFrame?"undefined"==typeof msCancelAnimationFrame?"undefined"==typeof cancelAnimationFrame&&(cancelAnimationFrame=function(e){clearTimeout(e)}):cancelAnimationFrame=msCancelAnimationFrame:cancelAnimationFrame=mozCancelAnimationFrame:cancelAnimationFrame=webkitCancelAnimationFrame);var AudioContext=window.AudioContext;"undefined"==typeof AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"==typeof URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&"undefined"==typeof navigator.getUserMedia&&("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isFirefox=-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(navigator.userAgent),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia||isElectron()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);isSafari&&!isChrome&&-1!==navigator.userAgent.indexOf("CriOS")&&(isSafari=!1,isChrome=!0);var MediaStream=window.MediaStream;"undefined"==typeof MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),"undefined"!=typeof MediaStream&&"undefined"==typeof MediaStream.prototype.stop&&(MediaStream.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})});function bytesToSize(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1000)),10);return(e/Math.pow(1000,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(t){}var a=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var i=t.split(".");t=i[0],a=i[1]}var o=(t||Math.round(9999999999*Math.random())+888888888)+"."+a;if("undefined"!=typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,o);if("undefined"!=typeof navigator.msSaveBlob)return navigator.msSaveBlob(e,o);var r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=o,r.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(r),"function"==typeof r.click?r.click():(r.target="_blank",r.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),URL.revokeObjectURL(r.href)}function isElectron(){return!("undefined"==typeof window||"object"!=typeof window.process||"renderer"!==window.process.type)||"undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.electron||!!("object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron"))}function getTracks(e,a){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(a||"audio")}):[]}function setSrcObject(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}function getSeekableBlob(e,t){if("undefined"==typeof EBML)throw new Error("Please link: https://cdn.webrtc-experiment.com/EBML.js");var a=new EBML.Reader,i=new EBML.Decoder,o=EBML.tools,r=new FileReader;r.onload=function(){var e=i.decode(this.result);e.forEach(function(e){a.read(e)}),a.stop();var r=o.makeMetadataSeekable(a.metadatas,a.duration,a.cues),d=this.result.slice(a.metadataSize),n=new Blob([r,d],{type:"video/webm"});t(n)},r.readAsArrayBuffer(e)}var Storage={};"undefined"==typeof AudioContext?"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext):Storage.AudioContext=AudioContext,"undefined"!=typeof RecordRTC&&(RecordRTC.Storage=Storage);function isMediaRecorderCompatible(){if(isFirefox||isSafari||isEdge)return!0;var e,t,a=navigator.appVersion,i=navigator.userAgent,o=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10);return(isChrome||isOpera)&&(e=i.indexOf("Chrome"),o=i.substring(e+7)),-1!==(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!==(t=o.indexOf(" "))&&(o=o.substring(0,t)),r=parseInt(""+o,10),isNaN(r)&&(o=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10)),49<=r}function MediaStreamRecorder(t,a){function i(){n.timestamps.push(new Date().getTime()),"function"==typeof a.onTimeStamp&&a.onTimeStamp(n.timestamps[n.timestamps.length-1],n.timestamps)}function o(e){return u&&u.mimeType?u.mimeType:e.mimeType||"video/webm"}function r(){c=[],u=null,n.timestamps=[]}function d(){if("active"in t){if(!t.active)return!1;}else if("ended"in t&&t.ended)return!1;return!0}var n=this;if("undefined"==typeof t)throw"First argument \"MediaStream\" is required.";if("undefined"==typeof MediaRecorder)throw"Your browser does not supports Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(a=a||{mimeType:"video/webm"},"audio"===a.type){if(getTracks(t,"video").length&&getTracks(t,"audio").length){var s;navigator.mozGetUserMedia?(s=new MediaStream,s.addTrack(getTracks(t,"audio")[0])):s=new MediaStream(getTracks(t,"audio")),t=s}a.mimeType&&-1!==a.mimeType.toString().toLowerCase().indexOf("audio")||(a.mimeType=isChrome?"audio/webm":"audio/ogg"),a.mimeType&&"audio/ogg"!==a.mimeType.toString().toLowerCase()&&!!navigator.mozGetUserMedia&&(a.mimeType="audio/ogg")}var c=[];this.getArrayOfBlobs=function(){return c},this.record=function(){n.blob=null,n.clearRecordedData(),n.timestamps=[],l=[],c=[];var r=a;a.disableLogs||console.log("Passing following config over MediaRecorder API.",r),u&&(u=null),isChrome&&!isMediaRecorderCompatible()&&(r="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&r.mimeType&&!MediaRecorder.isTypeSupported(r.mimeType)&&(!a.disableLogs&&console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType),r.mimeType="audio"===a.type?"audio/webm":"video/webm");try{u=new MediaRecorder(t,r),a.mimeType=r.mimeType}catch(a){u=new MediaRecorder(t)}r.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in u&&!1===u.canRecordMimeType(r.mimeType)&&!a.disableLogs&&console.warn("MediaRecorder API seems unable to record mimeType:",r.mimeType),u.ondataavailable=function(t){if(t.data&&l.push("ondataavailable: "+bytesToSize(t.data.size)),"number"==typeof a.timeSlice){if(t.data&&t.data.size&&100<t.data.size&&(c.push(t.data),i(),"function"==typeof a.ondataavailable)){var e=a.getNativeBlob?t.data:new Blob([t.data],{type:o(r)});a.ondataavailable(e)}return}return!t.data||!t.data.size||100>t.data.size||n.blob?void(n.recordingCallback&&(n.recordingCallback(new Blob([],{type:o(r)})),n.recordingCallback=null)):void(n.blob=a.getNativeBlob?t.data:new Blob([t.data],{type:o(r)}),n.recordingCallback&&(n.recordingCallback(n.blob),n.recordingCallback=null))},u.onstart=function(){l.push("started")},u.onpause=function(){l.push("paused")},u.onresume=function(){l.push("resumed")},u.onstop=function(){l.push("stopped")},u.onerror=function(e){e&&(!e.name&&(e.name="UnknownError"),l.push("error: "+e),!a.disableLogs&&(-1===e.name.toString().toLowerCase().indexOf("invalidstate")?-1===e.name.toString().toLowerCase().indexOf("notsupported")?-1===e.name.toString().toLowerCase().indexOf("security")?"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e):console.error("MediaRecorder security error",e):console.error("MIME type (",r.mimeType,") is not supported.",e):console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e)),function(e){return!n.manuallyStopped&&u&&"inactive"===u.state?(delete a.timeslice,void u.start(600000)):void setTimeout(e,1e3)}(),"inactive"!==u.state&&"stopped"!==u.state&&u.stop())},"number"==typeof a.timeSlice?(i(),u.start(a.timeSlice)):u.start(36e5),a.initCallback&&a.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},n.manuallyStopped=!0,u&&(this.recordingCallback=e,"recording"===u.state&&u.stop(),"number"==typeof a.timeSlice&&setTimeout(function(){n.blob=new Blob(c,{type:o(a)}),n.recordingCallback(n.blob)},100))},this.pause=function(){u&&("recording"!==u.state||u.pause())},this.resume=function(){u&&("paused"!==u.state||u.resume())},this.clearRecordedData=function(){u&&"recording"===u.state&&n.stop(r),r()};var u;this.getInternalRecorder=function(){return u},this.blob=null,this.getState=function(){return u?u.state||"inactive":"inactive"};var l=[];this.getAllStates=function(){return l},"undefined"==typeof a.checkForInactiveTracks&&(a.checkForInactiveTracks=!1);var n=this;(function e(){return u&&!1!==a.checkForInactiveTracks?!1===d()?(a.disableLogs||console.log("MediaStream seems stopped."),void n.stop()):void setTimeout(e,1e3):void 0})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}"undefined"!=typeof RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder);function StereoAudioRecorder(e,t){function a(){if(!1===t.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1;}else if("ended"in e&&e.ended)return!1;return!0}function i(e,t){function a(e,t){function a(e,t,a){var r=Math.round(e.length*(t/a)),d=[],n=+((e.length-1)/(r-1));d[0]=e[0];for(var s=1;s<r-1;s++){var c=s*n,u=(+Math.floor(c)).toFixed(),l=(+Math.ceil(c)).toFixed();d[s]=o(e[u],e[l],c-u)}return d[r-1]=e[e.length-1],d}function o(e,t,a){return e+(t-e)*a}function r(e,t){for(var a,o=new Float64Array(t),r=0,d=e.length,n=0;n<d;n++)a=e[n],o.set(a,r),r+=a.length;return o}function d(e,t){for(var a=e.length+t.length,i=new Float64Array(a),o=0,r=0;r<a;)i[r++]=e[o],i[r++]=t[o],o++;return i}function n(e,t,a){for(var o=a.length,r=0;r<o;r++)e.setUint8(t+r,a.charCodeAt(r))}var s=e.numberOfAudioChannels,c=e.leftBuffers.slice(0),u=e.rightBuffers.slice(0),l=e.sampleRate,g=e.internalInterleavedLength,m=e.desiredSampRate;2===s&&(c=r(c,g),u=r(u,g),m&&(c=a(c,m,l),u=a(u,m,l))),1===s&&(c=r(c,g),m&&(c=a(c,m,l))),m&&(l=m);var p;2===s&&(p=d(c,u)),1===s&&(p=c);var f=p.length,h=new ArrayBuffer(44+2*f),b=new DataView(h);n(b,0,"RIFF"),b.setUint32(4,36+2*f,!0),n(b,8,"WAVE"),n(b,12,"fmt "),b.setUint32(16,16,!0),b.setUint16(20,1,!0),b.setUint16(22,s,!0),b.setUint32(24,l,!0),b.setUint32(28,2*l,!0),b.setUint16(32,2*s,!0),b.setUint16(34,16,!0),n(b,36,"data"),b.setUint32(40,2*f,!0);for(var v=44,R=0;R<f;R++)b.setInt16(v,p[R]*(32767*1),!0),v+=2;return t?t({buffer:h,view:b}):void postMessage({buffer:h,view:b})}if(e.noWorker)return void a(e,function(e){t(e.buffer,e.view)});var i=o(a);i.onmessage=function(e){t(e.data.buffer,e.data.view),URL.revokeObjectURL(i.workerURL),i.terminate()},i.postMessage(e)}function o(e){var t=URL.createObjectURL(new Blob([e.toString(),";this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),a=new Worker(t);return a.workerURL=t,a}function r(){l=[],g=[],p=0,C=!1,m=!1,k=!1,v=null,u.leftchannel=l,u.rightchannel=g,u.numberOfAudioChannels=f,u.desiredSampRate=h,u.sampleRate=S,u.recordingLength=p,T={left:[],right:[],recordingLength:0}}function d(){c&&(c.onaudioprocess=null,c.disconnect(),c=null),R&&(R.disconnect(),R=null),r()}function n(i){if(!k){if(!1===a()&&(!t.disableLogs&&console.log("MediaStream seems stopped."),c.disconnect(),m=!1),!m)return void(R&&(R.disconnect(),R=null));C||(C=!0,t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback());var e=i.inputBuffer.getChannelData(0),o=new Float32Array(e);if(l.push(o),2===f){var r=i.inputBuffer.getChannelData(1),d=new Float32Array(r);g.push(d)}p+=y,u.recordingLength=p,"undefined"!=typeof t.timeSlice&&(T.recordingLength+=y,T.left.push(o),2===f&&T.right.push(d))}}function s(){m&&"function"==typeof t.ondataavailable&&"undefined"!=typeof t.timeSlice&&(T.left.length?(i({desiredSampRate:h,sampleRate:S,numberOfAudioChannels:f,internalInterleavedLength:T.recordingLength,leftBuffers:T.left,rightBuffers:1===f?[]:T.right},function(e,a){var i=new Blob([a],{type:"audio/wav"});t.ondataavailable(i),setTimeout(s,t.timeSlice)}),T={left:[],right:[],recordingLength:0}):setTimeout(s,t.timeSlice))}if(!getTracks(e,"audio").length)throw"Your stream has no audio tracks.";t=t||{};var c,u=this,l=[],g=[],m=!1,p=0,f=2,h=t.desiredSampRate;if(!0===t.leftChannel&&(f=1),1===t.numberOfAudioChannels&&(f=1),(!f||1>f)&&(f=2),t.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+f),"undefined"==typeof t.checkForInactiveTracks&&(t.checkForInactiveTracks=!0),this.record=function(){if(!1===a())throw"Please make sure MediaStream is active.";r(),C=k=!1,m=!0,"undefined"!=typeof t.timeSlice&&s()},this.stop=function(e){e=e||function(){},m=!1,i({desiredSampRate:h,sampleRate:S,numberOfAudioChannels:f,internalInterleavedLength:p,leftBuffers:l,rightBuffers:1===f?[]:g,noWorker:t.noWorker},function(t,a){u.blob=new Blob([a],{type:"audio/wav"}),u.buffer=new ArrayBuffer(a.buffer.byteLength),u.view=a,u.sampleRate=h||S,u.bufferSize=y,u.length=p,C=!1,e&&e(u.blob)})},"undefined"==typeof b)var b={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext};b.AudioContextConstructor||(b.AudioContextConstructor=new b.AudioContext);var v=b.AudioContextConstructor,R=v.createMediaStreamSource(e),w=[0,256,512,1024,2048,4096,8192,16384],y="undefined"==typeof t.bufferSize?4096:t.bufferSize;if(-1!==w.indexOf(y)||t.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(w,null,"\t")),v.createJavaScriptNode)c=v.createJavaScriptNode(y,f,f);else if(v.createScriptProcessor)c=v.createScriptProcessor(y,f,f);else throw"WebAudio API has no support on this browser.";R.connect(c),t.bufferSize||(y=c.bufferSize);var S="undefined"==typeof t.sampleRate?v.sampleRate||44100:t.sampleRate;(22050>S||96e3<S)&&!t.disableLogs&&console.log("sample-rate must be under range 22050 and 96000."),!t.disableLogs&&t.desiredSampRate&&console.log("Desired sample-rate: "+t.desiredSampRate);var k=!1;this.pause=function(){k=!0},this.resume=function(){if(!1===a())throw"Please make sure MediaStream is active.";return m?void(k=!1):(t.disableLogs||console.log("Seems recording has been restarted."),void this.record())},this.clearRecordedData=function(){t.checkForInactiveTracks=!1,m&&this.stop(d),d()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var C=!1;c.onaudioprocess=n,v.createMediaStreamDestination?c.connect(v.createMediaStreamDestination()):c.connect(v.destination),this.leftchannel=l,this.rightchannel=g,this.numberOfAudioChannels=f,this.desiredSampRate=h,this.sampleRate=S,u.recordingLength=p;var T={left:[],right:[],recordingLength:0}}"undefined"!=typeof RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder);function CanvasRecorder(e,t){function a(){p.frames=[],l=!1,g=!1}function i(){var t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.width,t.height=e.height,a.drawImage(e,0,0),t}function o(){if(g)return m=new Date().getTime(),setTimeout(o,500);if("canvas"===e.nodeName.toLowerCase()){var a=new Date().getTime()-m;return m=new Date().getTime(),p.frames.push({image:i(),duration:a}),void(l&&setTimeout(o,t.frameInterval))}html2canvas(e,{grabMouse:"undefined"==typeof t.showMousePointer||t.showMousePointer,onrendered:function(e){var a=new Date().getTime()-m;return a?void(m=new Date().getTime(),p.frames.push({image:e.toDataURL("image/webp",1),duration:a}),l&&setTimeout(o,t.frameInterval)):setTimeout(o,t.frameInterval)}})}if("undefined"==typeof html2canvas)throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";t=t||{},t.frameInterval||(t.frameInterval=10);var r=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(r=!0)});var d=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,n=50,s=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);d&&s&&s[2]&&(n=parseInt(s[2],10)),d&&52>n&&(r=!1),t.useWhammyRecorder&&(r=!1);var c,u;if(!r)!navigator.mozGetUserMedia||t.disableLogs||console.error("Canvas recording is NOT supported in Firefox.");else if(t.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)c=e;else if(e instanceof CanvasRenderingContext2D)c=e.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";var l;this.record=function(){if(l=!0,r&&!t.useWhammyRecorder){var e;"captureStream"in c?e=c.captureStream(25):"mozCaptureStream"in c?e=c.mozCaptureStream(25):"webkitCaptureStream"in c&&(e=c.webkitCaptureStream(25));try{var a=new MediaStream;a.addTrack(getTracks(e,"video")[0]),e=a}catch(t){}if(!e)throw"captureStream API are NOT available.";u=new MediaStreamRecorder(e,{mimeType:t.mimeType||"video/webm"}),u.record()}else p.frames=[],m=new Date().getTime(),o();t.initCallback&&t.initCallback()},this.getWebPImages=function(a){if("canvas"!==e.nodeName.toLowerCase())return void a();var i=p.frames.length;p.frames.forEach(function(e,a){var o=i-a;t.disableLogs||console.log(o+"/"+i+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(o,i);var r=e.image.toDataURL("image/webp",1);p.frames[a].image=r}),t.disableLogs||console.log("Generating WebM"),a()},this.stop=function(e){l=!1;var a=this;return r&&u?void u.stop(e):void this.getWebPImages(function(){p.compile(function(i){t.disableLogs||console.log("Recording finished!"),a.blob=i,a.blob.forEach&&(a.blob=new Blob([],{type:"video/webm"})),e&&e(a.blob),p.frames=[]})})};var g=!1;this.pause=function(){if(g=!0,u instanceof MediaStreamRecorder)return void u.pause()},this.resume=function(){return g=!1,u instanceof MediaStreamRecorder?void u.resume():void(!l&&this.record())},this.clearRecordedData=function(){l&&this.stop(a),a()},this.name="CanvasRecorder",this.toString=function(){return this.name};var m=new Date().getTime(),p=new Whammy.Video(100)}"undefined"!=typeof RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder);function WhammyRecorder(e,t){function a(e){e="undefined"==typeof e?10:e;var t=new Date().getTime()-c;return t?n?(c=new Date().getTime(),setTimeout(a,100)):void(c=new Date().getTime(),s.paused&&s.play(),g.drawImage(s,0,0,l.width,l.height),u.frames.push({duration:t,image:l.toDataURL("image/webp")}),!d&&setTimeout(a,e,e)):setTimeout(a,e,e)}function i(e){var t=-1,a=e.length;(function i(){return t++,t===a?void e.callback():void setTimeout(function(){e.functionToLoop(i,t)},1)})()}function o(e,t,a,o,r){var d=document.createElement("canvas");d.width=l.width,d.height=l.height;var n=d.getContext("2d"),s=[],c=t&&0<t&&t<=e.length?t:e.length,u={r:0,g:0,b:0},g=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=a&&0<=a&&1>=a?a:0,p=o&&0<=o&&1>=o?o:0,h=!1;i({length:c,functionToLoop:function(a,i){var o,r,d,c=function(){!h&&d-o<=d*p||(-1===t&&(h=!0),s.push(e[i])),a()};if(!h){var f=new Image;f.onload=function(){n.drawImage(f,0,0,l.width,l.height);var e=n.getImageData(0,0,l.width,l.height);o=0,r=e.data.length,d=e.data.length/4;for(var t=0;t<r;t+=4){var a={r:e.data[t],g:e.data[t+1],b:e.data[t+2]},i=Math.sqrt(Math.pow(a.r-u.r,2)+Math.pow(a.g-u.g,2)+Math.pow(a.b-u.b,2));i<=g*m&&o++}c()},f.src=e[i].image}else c()},callback:function(){s=s.concat(e.slice(c)),0>=s.length&&s.push(e[e.length-1]),r(s)}})}function r(){u.frames=[],d=!0,n=!1}t=t||{},t.frameInterval||(t.frameInterval=10),t.disableLogs||console.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),l.width=t.canvas.width||320,l.height=t.canvas.height||240,g=l.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(s=t.video.cloneNode(),t.initCallback&&t.initCallback()):(s=document.createElement("video"),setSrcObject(e,s),s.onloadedmetadata=function(){t.initCallback&&t.initCallback()},s.width=t.video.width,s.height=t.video.height),s.muted=!0,s.play(),c=new Date().getTime(),u=new Whammy.Video,t.disableLogs||(console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",s.width||l.width,"*",s.height||l.height)),a(t.frameInterval)};var d=!1;this.stop=function(e){e=e||function(){},d=!0;var a=this;setTimeout(function(){o(u.frames,-1,null,null,function(i){u.frames=i,t.advertisement&&t.advertisement.length&&(u.frames=t.advertisement.concat(u.frames)),u.compile(function(t){a.blob=t,a.blob.forEach&&(a.blob=new Blob([],{type:"video/webm"})),e&&e(a.blob)})})},10)};var n=!1;this.pause=function(){n=!0},this.resume=function(){n=!1,d&&this.record()},this.clearRecordedData=function(){d||this.stop(r),r()},this.name="WhammyRecorder",this.toString=function(){return this.name};var s,c,u,l=document.createElement("canvas"),g=l.getContext("2d")}"undefined"!=typeof RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),a=new Worker(t);return URL.revokeObjectURL(t),a}function a(e){function t(e,t,a){return[{data:e,id:231}].concat(a.map(function(e){var a=s({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:a,id:163}}))}function a(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,a=e[0].height,o=e[0].duration,r=1;r<e.length;r++)o+=e[r].duration;return{duration:o,width:t,height:a}}function o(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e){return new Uint8Array(e.split("").map(function(t){return t.charCodeAt(0)}))}function d(e){var t=[],a=e.length%8?Array(9-e.length%8).join("0"):"";e=a+e;for(var o=0;o<e.length;o+=8)t.push(parseInt(e.substr(o,8),2));return new Uint8Array(t)}function n(e){for(var t,a=[],s=0;s<e.length;s++){t=e[s].data,"object"==typeof t&&(t=n(t)),"number"==typeof t&&(t=d(t.toString(2))),"string"==typeof t&&(t=r(t));var c=t.size||t.byteLength||t.length,u=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),l=c.toString(2),g=Array(7*u+7+1-l.length).join("0")+l,m=Array(u).join("0")+"1"+g;a.push(o(e[s].id)),a.push(d(m)),a.push(t)}return new Blob(a,{type:"video/webm"})}function s(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),127<e.trackNum)throw"TrackNumber > 127 not supported";var a=[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(t){return String.fromCharCode(t)}).join("")+e.frame;return a}function c(e){for(var t=e.RIFF[0].WEBP[0],a=t.indexOf("\x9D\x01*"),o=0,r=[];4>o;o++)r[o]=t.charCodeAt(a+3+o);var d,n,s;return s=r[1]<<8|r[0],d=16383&s,s=r[3]<<8|r[2],n=16383&s,{width:d,height:n,data:t,riff:e}}function u(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return Array(8-t.length+1).join("0")+t}).join(""),2)}function l(e){for(var t=0,a={};t<e.length;){var i=e.substr(t,4),o=u(e,t),r=e.substr(t+4+4,o);t+=8+o,a[i]=a[i]||[],"RIFF"===i||"LIST"===i?a[i].push(l(r)):a[i].push(r)}return a}function g(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")}var m=new function(e){var i=a(e);if(!i)return[];for(var o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:g(i.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:i.width,id:176},{data:i.height,id:186}]}]}]}]}],r=0,d=0;r<e.length;){var s=[],c=0;do s.push(e[r]),c+=e[r].duration,r++;while(r<e.length&&c<3e4);var u={id:524531317,data:t(d,0,s)};o[1].data.push(u),d+=c}return n(o)}(e.map(function(e){var t=c(l(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(m)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var i=t(a);i.onmessage=function(t){return t.data.error?void console.error(t.data.error):void e(t.data)},i.postMessage(this.frames)},{Video:e}}();"undefined"!=typeof RecordRTC&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){function e(e){e.createObjectStore(a.dataStoreName)}function t(){function e(e){t.objectStore(a.dataStoreName).get(e).onsuccess=function(t){a.callback&&a.callback(t.target.result,e)}}var t=i.transaction([a.dataStoreName],"readwrite");a.videoBlob&&t.objectStore(a.dataStoreName).put(a.videoBlob,"videoBlob"),a.gifBlob&&t.objectStore(a.dataStoreName).put(a.gifBlob,"gifBlob"),a.audioBlob&&t.objectStore(a.dataStoreName).put(a.audioBlob,"audioBlob"),e("audioBlob"),e("videoBlob"),e("gifBlob")}var a=this;if("undefined"==typeof indexedDB||"undefined"==typeof indexedDB.open)return void console.error("IndexedDB API are not available in this browser.");var i,o=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),r=indexedDB.open(o,1);r.onerror=a.onError,r.onsuccess=function(){if(i=r.result,i.onerror=a.onError,!i.setVersion)t();else if(1!==i.version){var o=i.setVersion(1);o.onsuccess=function(){e(i),t()}}else t()},r.onupgradeneeded=function(t){e(t.target.result)}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};"undefined"!=typeof RecordRTC&&(RecordRTC.DiskStorage=DiskStorage);function GifRecorder(e,t){function a(){m&&(m.stream().bin=[])}if("undefined"==typeof GIFEncoder){var i=document.createElement("script");i.src="https://cdn.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(i)}t=t||{};var o=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){function e(a){if(!0!==f.clearedRecordedData){if(r)return setTimeout(function(){e(a)},100);p=requestAnimationFrame(e),void 0===typeof g&&(g=a),90>a-g||(!o&&c.paused&&c.play(),!o&&n.drawImage(c,0,0,d.width,d.height),t.onGifPreview&&t.onGifPreview(d.toDataURL("image/png")),m.addFrame(n),g=a)}}return"undefined"==typeof GIFEncoder?void setTimeout(f.record,1e3):s?void(!o&&(!t.width&&(t.width=c.offsetWidth||320),!t.height&&(t.height=c.offsetHeight||240),!t.video&&(t.video={width:t.width,height:t.height}),!t.canvas&&(t.canvas={width:t.width,height:t.height}),d.width=t.canvas.width||320,d.height=t.canvas.height||240,c.width=t.video.width||320,c.height=t.video.height||240),m=new GIFEncoder,m.setRepeat(0),m.setDelay(t.frameRate||200),m.setQuality(t.quality||10),m.start(),"function"==typeof t.onGifRecordingStarted&&t.onGifRecordingStarted(),u=Date.now(),p=requestAnimationFrame(e),t.initCallback&&t.initCallback()):void setTimeout(f.record,1e3)},this.stop=function(e){e=e||function(){},p&&cancelAnimationFrame(p),l=Date.now(),this.blob=new Blob([new Uint8Array(m.stream().bin)],{type:"image/gif"}),e(this.blob),m.stream().bin=[]};var r=!1;this.pause=function(){r=!0},this.resume=function(){r=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,a()},this.name="GifRecorder",this.toString=function(){return this.name};var d=document.createElement("canvas"),n=d.getContext("2d");o&&(e instanceof CanvasRenderingContext2D?(n=e,d=n.canvas):e instanceof HTMLCanvasElement&&(n=e.getContext("2d"),d=e));var s=!0;if(!o){var c=document.createElement("video");c.muted=!0,c.autoplay=!0,s=!1,c.onloadedmetadata=function(){s=!0},setSrcObject(e,c),c.play()}var u,l,g,m,p=null,f=this}"undefined"!=typeof RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);function MultiStreamsMixer(e){function t(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}function a(){if(!c){var e=s.length,t=!1,o=[];if(s.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:o.push(e)}),t)u.width=t.stream.width,u.height=t.stream.height;else if(o.length){u.width=1<e?2*o[0].width:o[0].width;var r=1;(3===e||4===e)&&(r=2),(5===e||6===e)&&(r=3),(7===e||8===e)&&(r=4),(9===e||10===e)&&(r=5),u.height=o[0].height*r}else u.width=g.width||360,u.height=g.height||240;t&&t instanceof HTMLVideoElement&&i(t),o.forEach(function(e,t){i(e,t)}),setTimeout(a,g.frameInterval)}}function i(e,t){if(!c){var a=0,i=0,o=e.width,r=e.height;1===t&&(a=e.width),2===t&&(i=e.height),3===t&&(a=e.width,i=e.height),4===t&&(i=2*e.height),5===t&&(a=e.width,i=2*e.height),6===t&&(i=3*e.height),7===t&&(a=e.width,i=3*e.height),"undefined"!=typeof e.stream.left&&(a=e.stream.left),"undefined"!=typeof e.stream.top&&(i=e.stream.top),"undefined"!=typeof e.stream.width&&(o=e.stream.width),"undefined"!=typeof e.stream.height&&(r=e.stream.height),l.drawImage(e,a,i,o,r),"function"==typeof e.stream.onRender&&e.stream.onRender(l,a,i,o,r,t)}}function o(){n();var e;"captureStream"in u?e=u.captureStream():"mozCaptureStream"in u?e=u.mozCaptureStream():!g.disableLogs&&console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new f;return e.getTracks().filter(function(e){return"video"===e.kind}).forEach(function(e){t.addTrack(e)}),u.stream=t,t}function r(){h.AudioContextConstructor||(h.AudioContextConstructor=new h.AudioContext),g.audioContext=h.AudioContextConstructor,g.audioSources=[],!0===g.useGainNode&&(g.gainNode=g.audioContext.createGain(),g.gainNode.connect(g.audioContext.destination),g.gainNode.gain.value=0);var t=0;if(e.forEach(function(e){if(e.getTracks().filter(function(e){return"audio"===e.kind}).length){t++;var a=g.audioContext.createMediaStreamSource(e);!0===g.useGainNode&&a.connect(g.gainNode),g.audioSources.push(a)}}),!!t)return g.audioDestination=g.audioContext.createMediaStreamDestination(),g.audioSources.forEach(function(e){e.connect(g.audioDestination)}),g.audioDestination.stream}function d(e){var a=document.createElement("video");return t(e,a),a.muted=!0,a.volume=0,a.width=e.width||g.width||360,a.height=e.height||g.height||240,a.play(),a}function n(t){s=[],t=t||e,t.forEach(function(e){if(e.getTracks().filter(function(e){return"video"===e.kind}).length){var t=d(e);t.stream=e,s.push(t)}})}var s=[],c=!1,u=document.createElement("canvas"),l=u.getContext("2d");u.style="opacity:0;position:absolute;z-index:-1;top: -100000000px;left:-1000000000px; margin-top:-1000000000px;margin-left:-1000000000px;",(document.body||document.documentElement).appendChild(u),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var g=this,m=window.AudioContext;"undefined"==typeof m&&("undefined"!=typeof webkitAudioContext&&(m=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(m=mozAudioContext));var p=window.URL;"undefined"==typeof p&&"undefined"!=typeof webkitURL&&(p=webkitURL),"undefined"!=typeof navigator&&"undefined"==typeof navigator.getUserMedia&&("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var f=window.MediaStream;"undefined"==typeof f&&"undefined"!=typeof webkitMediaStream&&(f=webkitMediaStream),"undefined"!=typeof f&&"undefined"==typeof f.prototype.stop&&(f.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})});var h={};"undefined"==typeof m?"undefined"!=typeof webkitAudioContext&&(h.AudioContext=webkitAudioContext):h.AudioContext=m,this.startDrawingFrames=function(){a()},this.appendStreams=function(t){if(!t)throw"First parameter is required.";t instanceof Array||(t=[t]),e.concat(t),t.forEach(function(e){if(e.getTracks().filter(function(e){return"video"===e.kind}).length){var t=d(e);t.stream=e,s.push(t)}if(e.getTracks().filter(function(e){return"audio"===e.kind}).length&&g.audioContext){var a=g.audioContext.createMediaStreamSource(e);a.connect(g.audioDestination),g.audioSources.push(a)}})},this.releaseStreams=function(){s=[],c=!0,g.gainNode&&(g.gainNode.disconnect(),g.gainNode=null),g.audioSources.length&&(g.audioSources.forEach(function(e){e.disconnect()}),g.audioSources=[]),g.audioDestination&&(g.audioDestination.disconnect(),g.audioDestination=null),g.audioContext&&g.audioContext.close(),g.audioContext=null,l.clearRect(0,0,u.width,u.height),u.stream&&(u.stream.stop(),u.stream=null)},this.resetVideoStreams=function(e){e&&!(e instanceof Array)&&(e=[e]),n(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){c=!1;var t=o(),a=r();a&&a.getTracks().filter(function(e){return"audio"===e.kind}).forEach(function(e){t.addTrack(e)});var i;return e.forEach(function(e){e.fullcanvas&&(i=!0)}),t}}function MultiStreamRecorder(e,t){function a(){var t=[];return e.forEach(function(e){getTracks(e,"video").forEach(function(e){t.push(e)})}),t}e=e||[];var i,o,r=this;t=t||{mimeType:"video/webm",video:{width:360,height:240}},t.frameInterval||(t.frameInterval=10),t.video||(t.video={}),t.video.width||(t.video.width=360),t.video.height||(t.video.height=240),this.record=function(){i=new MultiStreamsMixer(e),a().length&&(i.frameInterval=t.frameInterval||10,i.width=t.video.width||360,i.height=t.video.height||240,i.startDrawingFrames()),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(i.getMixedStream()),o=new MediaStreamRecorder(i.getMixedStream(),t),o.record()},this.stop=function(e){o&&o.stop(function(t){r.blob=t,e(t),r.clearRecordedData()})},this.pause=function(){o&&o.pause()},this.resume=function(){o&&o.resume()},this.clearRecordedData=function(){o&&(o.clearRecordedData(),o=null),i&&(i.releaseStreams(),i=null)},this.addStreams=function(t){if(!t)throw"First parameter is required.";t instanceof Array||(t=[t]),e.concat(t);o&&i&&i.appendStreams(t)},this.resetVideoStreams=function(e){i&&(e&&!(e instanceof Array)&&(e=[e]),i.resetVideoStreams(e))},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}"undefined"!=typeof RecordRTC&&(RecordRTC.MultiStreamRecorder=MultiStreamRecorder);function RecordRTCPromisesHandler(e,t){if(!this)throw"Use \"new RecordRTCPromisesHandler()\"";if("undefined"==typeof e)throw"First argument \"MediaStream\" is required.";var a=this;a.recordRTC=new RecordRTC(e,t),this.startRecording=function(){return new Promise(function(e,t){try{a.recordRTC.startRecording(),e()}catch(a){t(a)}})},this.stopRecording=function(){return new Promise(function(e,t){try{a.recordRTC.stopRecording(function(i){return a.blob=a.recordRTC.getBlob(),a.blob&&a.blob.size?void e(i):void t("Empty blob.",a.blob)})}catch(a){t(a)}})},this.getDataURL=function(){return new Promise(function(e,t){try{a.recordRTC.getDataURL(function(t){e(t)})}catch(a){t(a)}})},this.getBlob=function(){return new Promise(function(e,t){try{e(a.recordRTC.getBlob())}catch(a){t(a)}})},this.blob=null}"undefined"!=typeof RecordRTC&&(RecordRTC.RecordRTCPromisesHandler=RecordRTCPromisesHandler);function WebAssemblyRecorder(e,t){function a(){return new ReadableStream({start:function(a){var i=document.createElement("canvas"),o=document.createElement("video");o.srcObject=e,o.onplaying=function(){i.width=t.width,i.height=t.height;var e=i.getContext("2d"),r=1e3/t.frameRate;setTimeout(function i(){e.drawImage(o,0,0),a.enqueue(e.getImageData(0,0,t.width,t.height)),setTimeout(i,r)},r)},o.play()}})}function i(e,o){if(!t.workerPath&&!o)return void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(t){t.arrayBuffer().then(function(t){i(e,t)})});if(!t.workerPath&&o instanceof ArrayBuffer){var s=new Blob([o],{type:"text/javascript"});t.workerPath=URL.createObjectURL(s)}t.workerPath||console.error("workerPath parameter is missing."),r=new Worker(t.workerPath),r.postMessage(t.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),r.addEventListener("message",function(e){"READY"===e.data?(r.postMessage({width:t.width,height:t.height,bitrate:t.bitrate||1200,timebaseDen:t.frameRate||30,realtime:!0}),a().pipeTo(new WritableStream({write:function(e){r&&r.postMessage(e.data.buffer,[e.data.buffer])}}))):!!e.data&&!d&&n.push(e.data)})}function o(){r&&(r.postMessage(null),r.terminate(),r=null)}("undefined"==typeof ReadableStream||"undefined"==typeof WritableStream)&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),t=t||{},t.width=t.width||640,t.height=t.height||480,t.frameRate=t.frameRate||30,t.bitrate=t.bitrate||1200;var r;this.record=function(){n=[],d=!1,this.blob=null,i(e),"function"==typeof t.initCallback&&t.initCallback()};var d;this.pause=function(){d=!0},this.resume=function(){d=!1};var n=[];this.stop=function(e){o(),this.blob=new Blob(n,{type:"video/webm"}),e(this.blob)},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){n=[],d=!1,this.blob=null},this.blob=null}"undefined"!=typeof RecordRTC&&(RecordRTC.WebAssemblyRecorder=WebAssemblyRecorder);